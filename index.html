<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rio Diario - Sistema de Registro</title>
    <!-- ICON -->
    <link rel="icon" type="image/png" href="https://st5.depositphotos.com/4520249/65196/v/450/depositphotos_651965852-stock-illustration-valid-user-profile-icon-vector.jpg">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #002060;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --light-color: #ecf0f1;
            --dark-color: #002060;
        }

        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .navbar {
            background-color: var(--primary-color);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .card {
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border: none;
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-header .badge {
            font-size: 0.7rem;
        }

        .btn-primary {
            background-color: var(--secondary-color);
            border: none;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-success {
            background-color: var(--success-color);
            border: none;
        }

        .btn-danger {
            background-color: var(--accent-color);
            border: none;
        }
        
        .section-title {
            border-left: 4px solid var(--secondary-color);
            padding-left: 10px;
            margin: 20px 0;
            color: var(--dark-color);
        }

        .image-preview {
            width: 100%;
            height: 200px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin-bottom: 15px;
            background-color: #f9f9f9;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .image-container {
            position: relative;
            margin-bottom: 15px;
        }

        .image-actions {
            position: absolute;
            bottom: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }

        .function-item {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 3px solid var(--secondary-color);
        }

        .footer {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            margin-top: 40px;
        }

        .print-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 100;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .action-buttons {
            position: fixed;
            bottom: 100px;
            right: 30px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .action-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            font-size: 20px;
        }

        .clima-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .clima-option {
            flex: 1;
            min-width: 120px;
            text-align: center;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .clima-option:hover {
            border-color: var(--secondary-color);
        }

        .clima-option.selected {
            border-color: var(--secondary-color);
            background-color: rgba(52, 152, 219, 0.1);
        }

        .clima-option i {
            font-size: 24px;
            margin-bottom: 5px;
            display: block;
        }

        .time-inputs {
            display: flex;
            gap: 10px;
        }

        .time-inputs .form-control {
            flex: 1;
        }

        .progress-bar-container {
            height: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--secondary-color);
            border-radius: 4px;
            width: 0%;
            transition: width 0.5s;
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
            font-size: 1.5rem;
        }

        /* Estilos para o PDF */
        #pdf-container {
            display: none;
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: white;
            color: black;
        }

        .pdf-header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #002060;
            padding-bottom: 10px;
        }

        .pdf-section {
            margin-bottom: 15px;
            page-break-inside: avoid;
        }

        .pdf-section-title {
            background-color: #002060;
            color: white;
            padding: 8px;
            font-weight: bold;
            margin-bottom: 10px;
            border-radius: 4px;
        }

        .pdf-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
        }

        .pdf-table th, .pdf-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .pdf-table th {
            background-color: #f2f2f2;
        }

        .pdf-image-container {
            margin-bottom: 15px;
            page-break-inside: avoid;
        }

        .pdf-image {
            max-width: 100%;
            max-height: 300px;
            margin-bottom: 5px;
            border: 1px solid #ddd;
        }

        .pdf-image-caption {
            font-style: italic;
            font-size: 0.9em;
            text-align: center;
        }

        /* NOVOS ESTILOS PARA PDF MELHORADO */
        .pdf-logo {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .pdf-logo img {
            max-height: 70px;
        }
        
        .pdf-header h1 {
            color: #002060;
            font-size: 24px;
            margin: 10px 0 5px 0;
        }
        
        .pdf-header p {
            color: #666;
            font-size: 14px;
            margin: 0;
        }
        
        .pdf-info-box {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .pdf-info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }
        
        .pdf-info-item {
            flex: 1;
            min-width: 200px;
            margin-bottom: 10px;
        }
        
        .pdf-info-label {
            font-weight: bold;
            color: #002060;
            margin-bottom: 3px;
        }
        
        .pdf-images-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .pdf-image-wrapper {
            width: calc(33.333% - 10px);
            margin-bottom: 15px;
            page-break-inside: avoid;
        }
        
        .pdf-image-box {
            border: 1px solid #ddd;
            padding: 8px;
            border-radius: 5px;
            background: white;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .pdf-image-box img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .signature-section {
            margin-top: 30px;
            page-break-inside: avoid;
        }
        
        .signature-title {
            text-align: center;
            font-weight: bold;
            margin-bottom: 20px;
            color: #002060;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        
        .signature-grid {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        
        .signature-box {
            width: 23%;
            min-width: 150px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .signature-line {
            height: 1px;
            background-color: #000;
            margin: 40px 0 10px 0;
        }
        
        .signature-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .signature-role {
            font-size: 0.9em;
            color: #666;
        }

        .pdf-footer {
            margin-top: 30px;
            font-size: 11px;
            color: #666;
            text-align: center;
            border-top: 1px solid #ddd;
            padding-top: 10px;
        }

        /* CORRE√á√ïES PARA A IMPRESS√ÉO DO PDF */
        @media print {
            body, html {
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
                font-size: 10pt !important;
                line-height: 1.2 !important;
                background: white !important;
                color: black !important;
            }
            
            .navbar, .btn, .footer, .print-btn, .action-buttons,
            .toast-container, .progress-bar-container {
                display: none !important;
            }
            
            .container {
                width: 100% !important;
                max-width: 100% !important;
                padding: 0.1in !important;
                margin: 0 !important;
            }
            
            #rdoForm, .container {
                display: none !important;
            }

            #pdf-container {
                display: block !important;
                width: 100% !important;
                margin: 0 !important;
                padding: 0.2in !important;
                font-size: 10pt !important;
                position: relative;
            }
            
            .pdf-header {
                margin-bottom: 0.2in !important;
                padding-bottom: 0.1in !important;
            }
            
            .pdf-header h1 {
                font-size: 14pt !important;
                margin: 5px 0 !important;
            }
            
            .pdf-header p {
                font-size: 9pt !important;
                margin: 0 !important;
            }
            
            .pdf-info-box {
                padding: 0.1in !important;
                margin-bottom: 0.2in !important;
            }
            
            .pdf-info-item {
                margin-bottom: 0.05in !important;
                min-width: auto !important;
            }
            
            .pdf-info-label {
                font-size: 9pt !important;
                margin-bottom: 0.02in !important;
            }
            
            .pdf-section {
                margin-bottom: 0.15in !important;
                page-break-inside: avoid !important;
            }
            
            .pdf-section-title {
                padding: 0.08in !important;
                font-size: 10pt !important;
                margin-bottom: 0.08in !important;
            }
            
            .pdf-table {
                font-size: 9pt !important;
                margin-bottom: 0.1in !important;
            }
            
            .pdf-table th, .pdf-table td {
                padding: 0.06in !important;
            }
            
            .pdf-images-grid {
                gap: 0.1in !important;
                margin-bottom: 0.1in !important;
            }
            
            .pdf-image-wrapper {
                width: calc(50% - 0.05in) !important;
                margin-bottom: 0.1in !important;
            }
            
            .pdf-image-box {
                height: 1.2in !important;
                padding: 0.05in !important;
            }
            
            .pdf-image-caption {
                font-size: 8pt !important;
            }
            
            /* CORRE√á√ÉO: Remover position:fixed das assinaturas e rodap√© */
            .signature-section {
                margin-top: 0.5in !important;
                page-break-inside: avoid !important;
                position: relative !important;
                bottom: auto !important;
                left: auto !important;
                right: auto !important;
            }
            
            .signature-title {
                margin-bottom: 0.1in !important;
                font-size: 10pt !important;
                padding-bottom: 0.05in !important;
            }
            
            .signature-line {
                margin: 0.3in 0 0.05in 0 !important;
            }
            
            .signature-name {
                font-size: 9pt !important;
                margin-bottom: 0.02in !important;
            }
            
            .signature-role {
                font-size: 8pt !important;
            }
            
            /* CORRE√á√ÉO: Alterar position do footer para relative */
            .pdf-footer {
                margin-top: 0.5in !important;
                font-size: 9pt !important;
                padding-top: 0.05in !important;
                border-top: 1px solid #ddd !important;
                position: relative !important;
                bottom: auto !important;
                left: auto !important;
                right: auto !important;
                text-align: center !important;
            }
            
            /* Garantir que n√£o haja quebras desnecess√°rias */
            .avoid-break {
                page-break-inside: avoid !important;
            }
            
            /* Reduzir espa√ßamento em listas */
            ol, ul {
                padding-left: 0.2in !important;
                margin-bottom: 0.1in !important;
            }
            
            li {
                margin-bottom: 0.05in !important;
            }

            /* Remover margem inferior do conte√∫do principal */
            .pdf-content {
                margin-bottom: 0.5in !important;
            }
            
            /* CORRE√á√ÉO: Centralizar assinaturas */
            .signature-grid {
                display: flex !important;
                justify-content: space-around !important;
                flex-wrap: wrap !important;
            }
            
            .signature-box {
                width: 23% !important;
                min-width: 150px !important;
                margin-bottom: 20px !important;
                text-align: center !important;
            }
        }

        /* Ajustes adicionais para melhor visualiza√ß√£o em mobile */
        @media (max-width: 768px) {
            .pdf-image-wrapper {
                width: 100% !important;
            }
            
            .signature-box {
                width: 48% !important;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-hard-hat me-2"></i>
                Relat√≥rio Diario
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#"><i class="fas fa-home me-1"></i> In√≠cio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-history me-1"></i> Hist√≥rico</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-cog me-1"></i> Configura√ß√µes</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Toast para notifica√ß√µes -->
    <div class="toast-container">
        <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto">Relat√≥rio Diario</strong>
                <small>Agora</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body"></div>
        </div>
    </div>

    <!-- Progress Bar -->
    <div class="container mt-3">
        <div class="progress-bar-container">
            <div class="progress-bar" id="form-progress"></div>
        </div>
    </div>

    <!-- Conte√∫do Principal -->
    <div class="container mt-4">
        <h1 class="display-4 text-center mb-4">Registro Di√°rio de Obra - RDO</h1>
        
        <form id="rdoForm">
            <!-- Dados B√°sicos -->
            <div class="card mb-4">
                <div class="card-header">
                    <div>
                        <i class="fas fa-info-circle me-2"></i>Dados B√°sicos
                    </div>
                    <span class="badge bg-secondary">Obrigat√≥rio</span>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="empresa" class="form-label">Empresa</label>
                            <select class="form-select" id="empresa" required>
                                <option value="">Selecione a empresa...</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="obra" class="form-label">Obra</label>
                            <select class="form-select" id="obra" required>
                                <option value="">Primeiro selecione uma empresa...</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="obraPc" class="form-label">N¬∫ do Pedido (PC)</label>
                            <input type="text" class="form-control" id="obraPc" readonly>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="data" class="form-label">Data</label>
                            <input type="date" class="form-control" id="data" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="turno" class="form-label">Turno</label>
                            <select class="form-select" id="turno" required>
                                <option value="">Selecione...</option>
                                <option value="manha">Manh√£ (07:30 - 12:00)</option>
                                <option value="tarde">Tarde (12:00 - 17:18)</option>
                                <option value="noite">Noite (19:00 - 00:00)</option>
                                <option value="madrugada">Noite (01:00 - 04:48)</option>
                                <option value="integral-dia">Integral Dia (07:30 - 17:18)</option>
                                <option value="integral-noite">Integral Noite (19:00 - 04:48)</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="encarregado" class="form-label">Encarregado</label>
                            <select class="form-select" id="encarregado" required>
                                <option value="">Selecione o encarregado...</option>
                                <option value="CLEOMARCIO ALMEIDA DOS SANTOS">CLEOMARCIO ALMEIDA DOS SANTOS</option>
                                <option value="GLECIO PEREIRA DE OLIVEIRA">GLECIO PEREIRA DE OLIVEIRA</option>
                                <option value="JUAREZ RODRIGUES RIBEIRO">JUAREZ RODRIGUES RIBEIRO</option>
                                <option value="MARCELO EDUARDO RAMPINELLI ROSA">MARCELO EDUARDO RAMPINELLI ROSA</option>
                                <option value="MARCIO WESLEY FANCHIOTI">MARCIO WESLEY FANCHIOTI</option>
                                <option value="ODIMAR PASSOS SOUZA">ODIMAR PASSOS SOUZA</option>
                                <option value="RILDO DE MORAES SILVA">RILDO DE MORAES SILVA</option>
                                <option value="VINICIUS DE JESUS SILVA">VINICIUS DE JESUS SILVA</option>
                                <option value="WENDREO RAMOS DANTAS">WENDREO RAMOS DANTAS</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <label for="area" class="form-label">√Årea/Unidade</label>
                            <select class="form-select" id="area" required>
                                <option value="">Primeiro selecione uma empresa...</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Condi√ß√µes Clim√°ticas -->
            <div class="card mb-4">
                <div class="card-header">
                    <div>
                        <i class="fas fa-cloud-sun me-2"></i>Condi√ß√µes Clim√°ticas
                    </div>
                    <span class="badge bg-secondary">Obrigat√≥rio</span>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Tempo durante o dia</label>
                        <div class="clima-selector">
                            <div class="clima-option" data-clima="ensolarado">
                                <i class="fas fa-sun"></i>
                                <span>Ensolarado</span>
                            </div>
                            <div class="clima-option" data-clima="nublado">
                                <i class="fas fa-cloud"></i>
                                <span>Nublado</span>
                            </div>
                            <div class="clima-option" data-clima="chuvoso">
                                <i class="fas fa-cloud-rain"></i>
                                <span>Chuvoso</span>
                            </div>
                            <div class="clima-option" data-clima="tempestuoso">
                                <i class="fas fa-poo-storm"></i>
                                <span>Tempestuoso</span>
                            </div>
                        </div>
                        <input type="hidden" id="clima" required>
                    </div>
                </div>
            </div>

            <!-- Atividades Realizadas -->
            <div class="card mb-4">
                <div class="card-header">
                    <div>
                        <i class="fas fa-tasks me-2"></i>Atividades Realizadas
                    </div>
                    <span class="badge bg-secondary">Obrigat√≥rio</span>
                </div>
                <div class="card-body">
                    <div id="atividades-container">
                        <div class="function-item">
                            <div class="mb-3">
                                <label class="form-label">Descri√ß√£o da Atividade</label>
                                <textarea class="form-control" name="atividade[]" rows="3" required placeholder="Descreva detalhadamente a atividade realizada..."></textarea>
                            </div>
                            <button type="button" class="btn btn-sm btn-danger remove-item">
                                <i class="fas fa-trash me-1"></i>Remover
                            </button>
                        </div>
                    </div>
                    <button type="button" class="btn btn-secondary mt-2" id="add-atividade">
                        <i class="fas fa-plus me-1"></i>Adicionar Atividade
                    </button>
                </div>
            </div>

            <!-- Equipe -->
            <div class="card mb-4">
                <div class="card-header">
                    <div>
                        <i class="fas fa-users me-2"></i>Equipe
                    </div>
                    <span class="badge bg-secondary">Obrigat√≥rio</span>
                </div>
                <div class="card-body">
                    <div id="equipe-container">
                        <div class="function-item">
                            <div class="row">
                                <div class="col-md-5 mb-3">
                                    <label class="form-label">Nome do Funcion√°rio</label>
                                    <input type="text" class="form-control" name="funcionario[]" required>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label class="form-label">Fun√ß√£o</label>
                                    <select class="form-select" name="funcao[]">
                                        <option value="">Selecione...</option>
                                        <option value="Soldador">Soldador</option>
                                        <option value="Caldeireiro">Caldeireiro</option>
                                        <option value="Mec√¢nico">Mec√¢nico</option>
                                        <option value="Auxiliar">Auxiliar</option>
                                        <option value="Encarregado">Encarregado</option>
                                        <option value="Supervisor">Supervisor</option>
                                        <option value="Planejador">Planejador</option>
                                        <option value="T√©cnico de Seguran√ßa">T√©cnico de Seguran√ßa</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Hor√°rio de Trabalho</label>
                                    <div class="time-inputs">
                                        <input type="time" class="form-control" name="entrada[]">
                                        <input type="time" class="form-control" name="saida[]">
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-sm btn-danger remove-item">
                                <i class="fas fa-trash me-1"></i>Remover
                            </button>
                        </div>
                    </div>
                    <button type="button" class="btn btn-secondary mt-2" id="add-funcionario">
                        <i class="fas fa-user-plus me-1"></i>Adicionar Funcion√°rio
                    </button>
                </div>
            </div>

            <!-- Anexos de Fotos -->
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-camera me-2"></i>Anexos de Fotos
                </div>
                <div class="card-body">
                    <div class="row" id="fotos-container">
                        <div class="col-md-4 mb-3">
                            <div class="image-preview">
                                <span class="text-muted">Pr√©-visualiza√ß√£o da imagem</span>
                            </div>
                            <input type="file" class="form-control foto-input" accept="image/*">
                            <div class="mt-2">
                                <input type="text" class="form-control form-control-sm foto-legenda" placeholder="Legenda da foto">
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-secondary mt-2" id="add-foto">
                        <i class="fas fa-plus me-1"></i>Adicionar Mais Fotos
                    </button>
                </div>
            </div>

            <!-- Bot√µes de A√ß√£o -->
            <div class="d-grid gap-2 d-md-flex justify-content-md-end mb-5">
                <button type="button" class="btn btn-danger me-md-2" id="clearAll">
                    <i class="fas fa-trash me-1"></i>Excluir Tudo
                </button>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-1"></i>Salvar e Exportar
                </button>
            </div>
        </form>
    </div>

    <!-- Container para o PDF (inicialmente oculto) -->
    <div id="pdf-container"></div>

    <!-- Footer -->
    <footer class="footer text-center">
        <div class="container">
            <p>Relat√≥rio Diario &copy; 2025 - Thaynison Couto</p>
            <p class="small">Desenvolvido para gerenciamento and controle de atividades em servi√ßos</p>
        </div>
    </footer>

    <!-- Bootstrap & jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const empresasData = {
            "empresas": [
                {
                    "nome": "Suzano Aracruz",
                    "unidades": [
                        "P√°tio de Madeira",
                        "Caldeira de Recupera√ß√£o",
                        "Caustifica√ß√£o",
                        "Evapora√ß√£o",
                        "Esta√ß√£o de Tratamento √Ågua",
                        "Esta√ß√£o de Tratamento Esgoto",
                        "Linha de Fibras",
                        "Secagem",
                        "Oficina Central"
                    ],
                    "obras": [
                        { "nome": "PP LINHA 5", "pc": "4502169545" },
                        { "nome": "TANQUE LBS", "pc": "4502224736" },
                        { "nome": "PG SECAGEM B", "pc": "4502223947" },
                        { "nome": "ATENDIMENTO AO BRANQUEAMENTO - LUCAS", "pc": "4502239784" },
                        { "nome": "ATENDIMENTO AO BRANQUEAMENTO - GUILHERME", "pc": "4502239788" },
                        { "nome": "FORNECIMENTO DE PLANEJADOR - FELIPE", "pc": "4502204259" }
                    ]
                },
                {
                    "nome": "Suzano Mucuri",
                    "unidades": [
                        "P√°tio de Madeira",
                        "Caldeira de Recupera√ß√£o",
                        "Caustifica√ß√£o",
                        "Evapora√ß√£o",
                        "Esta√ß√£o de Tratamento √Ågua",
                        "Esta√ß√£o de Tratamento Esgoto",
                        "Linha de Fibras",
                        "Secagem",
                        "Oficina Central"   
                    ],
                    "obras": [
                        { "nome": "*", "pc": "*" }
                    ]
                },
                {
                    "nome": "CGH Jo√£o Neiva",
                    "unidades": [
                        "CGH"
                    ],
                    "obras": [
                        { "nome": "*", "pc": "*" },
                    ]
                }
            ]
        };
        
        $(document).ready(function() {
            // Inicializar toast
            const toastEl = document.getElementById('liveToast');
            const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
            
            function showToast(message, type = 'success') {
                $('.toast-body').text(message);
                $('.toast').removeClass('bg-success bg-danger');
                
                if (type === 'error') {
                    $('.toast').addClass('bg-danger text-white');
                } else {
                    $('.toast').addClass('bg-success text-white');
                }
                
                toast.show();
            }

            // Preencher select de empresas
            function populateEmpresas() {
                const empresaSelect = $('#empresa');
                empresaSelect.empty().append('<option value="">Selecione a empresa...</option>');
                
                empresasData.empresas.forEach(empresa => {
                    empresaSelect.append($('<option>', {
                        value: empresa.nome,
                        text: empresa.nome
                    }));
                });
            }
            
            // Preencher select de √°reas baseado na empresa selecionada
            function populateAreas(empresaNome) {
                const areaSelect = $('#area');
                areaSelect.empty().append('<option value="">Selecione a √°rea...</option>');
                
                if (empresaNome) {
                    const empresa = empresasData.empresas.find(e => e.nome === empresaNome);
                    if (empresa && empresa.unidades) {
                        empresa.unidades.forEach(unidade => {
                            areaSelect.append($('<option>', {
                                value: unidade,
                                text: unidade
                            }));
                        });
                    }
                }
            }
            
            // Preencher select de obras baseado na empresa selecionada
            function populateObras(empresaNome) {
                const obraSelect = $('#obra');
                obraSelect.empty().append('<option value="">Selecione a obra...</option>');
                $('#obraPc').val(''); // Limpar o campo do PC
                
                if (empresaNome) {
                    const empresa = empresasData.empresas.find(e => e.nome === empresaNome);
                    if (empresa && empresa.obras) {
                        empresa.obras.forEach(obra => {
                            obraSelect.append($('<option>', {
                                value: obra.nome,
                                text: obra.nome,
                                'data-pc': obra.pc
                            }));
                        });
                    }
                }
            }
            
            // Evento quando a empresa √© alterada
            $('#empresa').change(function() {
                const empresaSelecionada = $(this).val();
                populateAreas(empresaSelecionada);
                populateObras(empresaSelecionada);
                updateProgress();
            });
            
            // Evento quando a obra √© alterada
            $('#obra').change(function() {
                const obraSelecionada = $(this).find('option:selected');
                const pcValue = obraSelecionada.data('pc') || '';
                $('#obraPc').val(pcValue);
                updateProgress();
            });

            // Definir data atual como padr√£o
            const today = new Date().toISOString().split('T')[0];
            $("#data").val(today);
            
            // Preencher empresas ao carregar a p√°gina
            populateEmpresas();
            
            // Atualizar barra de progresso
            function updateProgress() {
                const totalFields = 17;
                let filledFields = 0;
                
                // Verificar campos obrigat√≥rios
                $("#rdoForm input[required], #rdoForm select[required], #rdoForm textarea[required]").each(function() {
                    if ($(this).val() !== '') {
                        filledFields++;
                    }
                });
                
                // Calcular porcentagem
                const percentage = (filledFields / totalFields) * 100;
                $("#form-progress").css('width', percentage + '%');
                
                // Mudar cor baseada na porcentagem
                if (percentage < 30) {
                    $("#form-progress").css('background-color', '#e74c3c');
                } else if (percentage < 70) {
                    $("#form-progress").css('background-color', '#f39c12');
                } else {
                    $("#form-progress").css('background-color', '#27ae60');
                }
            }
            
            // Atualizar progresso quando os campos mudam
            $("#rdoForm input, #rdoForm select, #rdoForm textarea").on('input change', updateProgress);
            
            // Inicializar progresso
            updateProgress();
            
            // Sele√ß√£o de condi√ß√µes clim√°ticas
            $(".clima-option").click(function() {
                $(".clima-option").removeClass("selected");
                $(this).addClass("selected");
                $("#clima").val($(this).data("clima"));
                updateProgress();
            });
            
            // Adicionar nova atividade
            $("#add-atividade").click(function() {
                $("#atividades-container").append(`
                    <div class="function-item">
                        <div class="mb-3">
                            <label class="form-label">Descri√ß√£o da Atividade</label>
                            <textarea class="form-control" name="atividade[]" rows="3" required placeholder="Descreva detalhadamente a atividade realizada..."></textarea>
                        </div>
                        <button type="button" class="btn btn-sm btn-danger remove-item">
                            <i class="fas fa-trash me-1"></i>Remover
                        </button>
                    </div>
                `);
            });

            // Adicionar novo funcion√°rio
            $("#add-funcionario").click(function() {
                $("#equipe-container").append(`
                    <div class="function-item">
                        <div class="row">
                            <div class="col-md-5 mb-3">
                                <label class="form-label">Nome do Funcion√°rio</label>
                                <input type="text" class="form-control" name="funcionario[]" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Fun√ß√£o</label>
                                <select class="form-select" name="funcao[]">
                                    <option value="">Selecione...</option>
                                    <option value="Soldador">Soldador</option>
                                    <option value="Caldeireiro">Caldeireiro</option>
                                    <option value="Mec√¢nico">Mec√¢nico</option>
                                    <option value="Auxiliar">Auxiliar</option>
                                    <option value="Encarregado">Encarregado</option>
                                    <option value="Supervisor">Supervisor</option>
                                    <option value="Planejador">Planejador</option>
                                    <option value="T√©cnico de Seguran√ßa">T√©cnico de Seguran√ßa</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Hor√°rio de Trabalho</label>
                                <div class="time-inputs">
                                    <input type="time" class="form-control" name="entrada[]">
                                    <input type="time" class="form-control" name="saida[]">
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-sm btn-danger remove-item">
                            <i class="fas fa-trash me-1"></i>Remover
                        </button>
                    </div>
                `);
            });

            // Adicionar mais fotos
            $("#add-foto").click(function() {
                $("#fotos-container").append(`
                    <div class="col-md-4 mb-3">
                        <div class="image-preview">
                            <span class="text-muted">Pr√©-visualiza√ß√£o da imagem</span>
                        </div>
                        <input type="file" class="form-control foto-input" accept="image/*">
                        <div class="mt-2">
                            <input type="text" class="form-control form-control-sm foto-legenda" placeholder="Legenda da foto">
                        </div>
                    </div>
                `);
            });

            // Remover itens
            $(document).on("click", ".remove-item", function() {
                $(this).closest(".function-item").remove();
            });

            // Preview de imagem
            $(document).on("change", ".foto-input", function(e) {
                const previewDiv = $(this).prev(".image-preview");
                const file = e.target.files[0];
                
                if (file) {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        previewDiv.html(`<img src="${e.target.result}" alt="Preview">`);
                    }
                    
                    reader.readAsDataURL(file);
                } else {
                    previewDiv.html('<span class="text-muted">Pr√©-visualiza√ß√£o da imagem</span>');
                }
            });

            // Limpar formul√°rio
            $("#clearAll").click(function() {
                if (confirm("Tem certeza que deseja limpar todos os dados do formul√°rio?")) {
                    $("#rdoForm")[0].reset();
                    $(".image-preview").html('<span class="text-muted">Pr√©-visualiza√ß√£o da imagem</span>');
                    $(".clima-option").removeClass("selected");
                    $("#atividades-container, #equipe-container").html(`
                        <div class="function-item">
                            <div class="mb-3">
                                <label class="form-label">Descri√ß√£o da Atividade</label>
                                <textarea class="form-control" name="atividade[]" rows="3" required placeholder="Descreva detalhadamente a atividade realizada..."></textarea>
                            </div>
                            <button type="button" class="btn btn-sm btn-danger remove-item">
                                <i class="fas fa-trash me-1"></i>Remover
                            </button>
                        </div>
                    `);
                    $("#fotos-container").html(`
                        <div class="col-md-4 mb-3">
                            <div class="image-preview">
                                <span class="text-muted">Pr√©-visualiza√ß√£o da imagem</span>
                            </div>
                            <input type="file" class="form-control foto-input" accept="image/*">
                            <div class="mt-2">
                                <input type="text" class="form-control form-control-sm foto-legenda" placeholder="Legenda da foto">
                            </div>
                        </div>
                    `);
                    populateEmpresas();
                    updateProgress();
                    showToast("Formul√°rio limpo com sucesso!", "success");
                }
            });

            // Fun√ß√£o para gerar o PDF
            async function generatePDF(formData) {
                console.log("Iniciando gera√ß√£o do PDF...");
                
                try {
                    // Construir o conte√∫do do PDF
                    let pdfContent = `
                        <div class="pdf-content">
                            <div class="pdf-header">
                                <div class="pdf-logo">
                                    <h1>RELAT√ìRIO DI√ÅRIO DE OBRA</h1>
                                </div>
                            </div>
                            
                            <div class="pdf-info-box">
                                <div class="pdf-info-row">
                                    <div class="pdf-info-item">
                                        <div class="pdf-info-label">Empresa</div>
                                        <div>${formData.empresa || 'N√£o informado'}</div>
                                    </div>
                                    <div class="pdf-info-item">
                                        <div class="pdf-info-label">Obra</div>
                                        <div>${formData.obra}</div>
                                    </div>
                                    <div class="pdf-info-item">
                                        <div class="pdf-info-label">N¬∫ do Pedido (PC)</div>
                                        <div>${$("#obraPc").val() || 'N√£o informado'}</div>
                                    </div>
                                </div>
                                <div class="pdf-info-row">
                                    <div class="pdf-info-item">
                                        <div class="pdf-info-label">Data</div>
                                        <div>${new Date(formData.data).toLocaleDateString('pt-BR')}</div>
                                    </div>
                                    <div class="pdf-info-item">
                                        <div class="pdf-info-label">Turno</div>
                                        <div>${$("#turno option:selected").text()}</div>
                                    </div>
                                    <div class="pdf-info-item">
                                        <div class="pdf-info-label">Encarregado</div>
                                        <div>${formData.encarregado}</div>
                                    </div>
                                </div>
                                <div class="pdf-info-row">
                                    <div class="pdf-info-item">
                                        <div class="pdf-info-label">√Årea/Unidade</div>
                                        <div>${formData.area || 'N√£o informado'}</div>
                                    </div>
                                    <div class="pdf-info-item">
                                        <div class="pdf-info-label">Condi√ß√µes Clim√°ticas</div>
                                        <div>${getClimaDescription(formData.clima)}</div>
                                    </div>
                                    <div class="pdf-info-item">
                                        <div class="pdf-info-label">Data de Emiss√£o</div>
                                        <div>${new Date().toLocaleDateString('pt-BR')} √†s ${new Date().toLocaleTimeString('pt-BR')}</div>
                                    </div>
                                </div>
                            </div>
                    `;
                    
                    // Adicionar atividades
                    if (formData.atividades && formData.atividades.length > 0) {
                        pdfContent += `
                            <div class="pdf-section avoid-break">
                                <div class="pdf-section-title">Atividades Realizadas</div>
                                <ol>
                        `;
                        
                        formData.atividades.forEach(atividade => {
                            pdfContent += `<li>${atividade}</li>`;
                        });
                        
                        pdfContent += `
                                </ol>
                            </div>
                        `;
                    }
                    
                    // Adicionar equipe
                    if (formData.equipe && formData.equipe.length > 0) {
                        pdfContent += `
                            <div class="pdf-section avoid-break">
                                <div class="pdf-section-title">Equipe</div>
                                <table class="pdf-table">
                                    <thead>
                                        <tr>
                                            <th>Nome</th>
                                            <th>Fun√ß√£o</th>
                                            <th>Entrada</th>
                                            <th>Sa√≠da</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                        `;
                        
                        formData.equipe.forEach(membro => {
                            pdfContent += `
                                <tr>
                                    <td>${membro.nome || ''}</td>
                                    <td>${membro.funcao || ''}</td>
                                    <td>${membro.entrada || ''}</td>
                                    <td>${membro.saida || ''}</td>
                                </tr>
                            `;
                        });
                        
                        pdfContent += `
                                    </tbody>
                                </table>
                            </div>
                        `;
                    }
                    
                    // Adicionar fotos
                    if (formData.fotos && formData.fotos.length > 0) {
                        pdfContent += `
                            <div class="pdf-section avoid-break">
                                <div class="pdf-section-title">Anexos de Fotos</div>
                                <div class="pdf-images-grid">
                        `;
                        
                        for (let i = 0; i < formData.fotos.length; i++) {
                            const foto = formData.fotos[i];
                            if (foto.dataUrl) {
                                pdfContent += `
                                    <div class="pdf-image-wrapper">
                                        <div class="pdf-image-box">
                                            <img src="${foto.dataUrl}" alt="Foto ${i+1}">
                                        </div>
                                        <div class="pdf-image-caption">${foto.legenda || `Foto ${i+1}`}</div>
                                    </div>
                                `;
                            }
                        }
                        
                        pdfContent += `
                                </div>
                            </div>
                        `;
                    }
                    
                    pdfContent += `</div>`; // Fechar div.pdf-content
                    
                    // Adicionar se√ß√£o de assinaturas
                    pdfContent += `
                        <div class="signature-section avoid-break">
                            <div class="signature-title">ASSINATURAS</div>
                            <div class="signature-grid">
                                <div class="signature-box">
                                    <div class="signature-line"></div>
                                    <div class="signature-name">Encarregado</div>
                                    <div class="signature-role">Respons√°vel pela obra</div>
                                </div>
                                <div class="signature-box">
                                    <div class="signature-line"></div>
                                    <div class="signature-name">Planejador</div>
                                    <div class="signature-role">Respons√°vel pelo planejamento</div>
                                </div>
                                <div class="signature-box">
                                    <div class="signature-line"></div>
                                    <div class="signature-name">Supervisor</div>
                                    <div class="signature-role">Respons√°vel pela supervis√£o</div>
                                </div>
                                <div class="signature-box">
                                    <div class="signature-line"></div>
                                    <div class="signature-name">Resp. Contratante</div>
                                    <div class="signature-role">Respons√°vel pelo contratante</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="pdf-footer">
                            Relat√≥rio Diario &copy; 2025
                        </div>
                    `;
                    
                    // Inserir o conte√∫do no container do PDF
                    $("#pdf-container").html(pdfContent);
                    console.log("Conte√∫do do PDF gerado com sucesso");
                    
                    // Aguardar um momento para garantir que as imagens s√£o carregadas
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    // Acionar a impress√£o
                    window.print();
                    
                    setTimeout(() => {
                        showToast("PDF gerado com sucesso! Use a op√ß√£o 'Salvar como PDF' na janela de impress√£o.", "success");
                        console.log("PDF pronto para impress√£o/salvamento");
                    }, 1000);
                    
                } catch (error) {
                    console.error("Erro ao gerar PDF:", error);
                    showToast("Erro ao gerar PDF. Verifique o console para detalhes.", "error");
                }
            }
            
            // Fun√ß√£o auxiliar para obter descri√ß√£o do clima
            function getClimaDescription(clima) {
                const climas = {
                    'ensolarado': 'Ensolarado',
                    'nublado': 'Nublado',
                    'chuvoso': 'Chuvoso',
                    'tempestuoso': 'Tempestuoso'
                };
                return climas[clima] || 'N√£o especificado';
            }
            
            // Fun√ß√£o para ler arquivo como Data URL (base64)
            function readFileAsDataURL(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            }
            
            // Processar envio do formul√°rio
            $("#rdoForm").submit(async function(e) {
                e.preventDefault();
                console.log("Formul√°rio submetido. Iniciando coleta de dados...");
                
                // Validar formul√°rio
                if (!this.checkValidity()) {
                    this.reportValidity();
                    showToast("Preencha todos os campos obrigat√≥rios!", "error");
                    return;
                }
                
                // Coletar dados do formul√°rio
                const formData = {
                    obra: $("#obra").val(),
                    data: $("#data").val(),
                    turno: $("#turno").val(),
                    encarregado: $("#encarregado").val(),
                    empresa: $("#empresa").val(),
                    area: $("#area").val(),
                    clima: $("#clima").val(),
                    atividades: [],
                    equipe: [],
                    fotos: []
                };
                
                // Coletar atividades
                $("textarea[name='atividade[]']").each(function() {
                    if ($(this).val().trim() !== '') {
                        formData.atividades.push($(this).val().trim());
                    }
                });
                
                // Coletar equipe
                $(".function-item", "#equipe-container").each(function() {
                    const nome = $("input[name='funcionario[]']", this).val();
                    const funcao = $("select[name='funcao[]']", this).val();
                    const entrada = $("input[name='entrada[]']", this).val();
                    const saida = $("input[name='saida[]']", this).val();
                    
                    if (nome) {
                        formData.equipe.push({
                            nome: nome.trim(),
                            funcao: funcao,
                            entrada: entrada,
                            saida: saida
                        });
                    }
                });
                
                // Coletar fotos
                const fotoInputs = $(".foto-input");
                console.log(`Encontradas ${fotoInputs.length} entradas de foto`);
                
                for (let i = 0; i < fotoInputs.length; i++) {
                    const input = fotoInputs[i];
                    const file = input.files[0];
                    
                    if (file) {
                        try {
                            console.log(`Processando foto ${i+1}: ${file.name}`);
                            const dataUrl = await readFileAsDataURL(file);
                            const legenda = $(input).siblings('.mt-2').find('.foto-legenda').val();
                            
                            formData.fotos.push({
                                dataUrl: dataUrl,
                                legenda: legenda
                            });
                            
                            console.log(`Foto ${i+1} processada com sucesso`);
                        } catch (error) {
                            console.error(`Erro ao processar foto ${i+1}:`, error);
                        }
                    }
                }
                
                console.log("Todos os dados coletados. Iniciando gera√ß√£o do PDF...");
                
                // Gerar PDF
                await generatePDF(formData);
            });
        });
    </script>
</body>
</html>